<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... (código anterior) ... -->
</head>
<body>
    <h1>Publicaciones</h1>

    <!-- Formulario de Filtración por usuario_id -->
    <form action="{{ url_for('blog.view_post') }}" method="get">
        <label for="filtroUsuario">Filtrar por usuario_id:</label>
        <input type="text" id="filtroUsuario" name="filtroUsuario">
        <button type="submit">Filtrar</button>
        <button type="button" onclick="limpiarFiltro()">Limpiar filtro</button>
    </form>
    
    <script>
        function limpiarFiltro() {
            document.getElementById('filtroUsuario').value = '';
            // Puedes enviar el formulario aquí si quieres que se recargue automáticamente
            document.forms[0].submit();
        }
    </script>
    <ul>
        {% for post in posts %}
            <h2>{{ post.Titulo }} - {{ post.usuario_id }}</h2>
            <p>{{ post.texto }}</p>
            <p>{{ post.fechas }}</p>
            
            {% if post.servicio_id == '1' %}
                <img src="{{ url_for('static', filename='imagenes/imagen_servicio_1.jpg') }}" alt="Servicio 1">
            {% elif post.servicio_id == '2' %}
                <img src="{{ url_for('static', filename='imagenes/imagen_servicio_2.jpg') }}" alt="Servicio 2">
            {% elif post.servicio_id == '3' %}
                <img src="{{ url_for('static', filename='imagenes/imagen_servicio_3.jpg') }}" alt="Servicio 3">
            {% endif %}
            
            <button onclick="marcarConversada('{{ idpost }}')">Conversar</button>
            <button onclick="location.href='/ver_perfil/{{ post.usuario_id|replace(' ', '%20') }}'">Perfil</button>
        {% endfor %}    
    </ul>
    <button onclick="location.href='/opciones'">Volver opciones</button>
    <button onclick="location.href='/create_post'">Crear publicación</button>

    <script>
        function marcarConversada(idpost) {
    // Envía una solicitud al servidor para marcar la publicación como conversada
        fetch(`/marcar_conversada/${post.idpost}`, { method: 'POST' })
            .then(response => response.json())
            .then(data => {
            // Muestra una alerta con el mensaje personalizado
                window.alert(`Se le ha enviado un email a ${data.usuario_id}`);
            // Actualiza la interfaz de usuario según sea necesario
                console.log('Publicación marcada como conversada. Nuevo estado: ', data.conversada);

            // Elimina visualmente el elemento de la lista
                document.getElementById(`post_${idpost}`).style.display = 'none';
            })
            .catch(error => {
                console.error('Error al marcar la publicación como conversada:', error);
            });
        }
    </script>
</body>
</html>